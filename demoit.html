<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@5"></script>

<h1>Vega : dynamic test of transform</h1>

<split-view>
    <div style="text-align: left">
        Output of Vega SPEC .demoit/js/data.vg.json
        <div id="my-chart-id"></div>
    </div>
    <div style="text-align: left; overflow-x: auto">
        result.vgSpec.data =
        <div title="vega output" id="output-id">...</div>
    </div>
</split-view>

<script>
var cache = [];
// This function is useful for JSON.stringify
function dedup( key, value ) {
    if (typeof value === 'object' && value !== null) {
        // Duplicate reference found, discard key
        if (cache.includes(value)) return;

        // Store value in our collection
        cache.push(value);
    }
    cache = [];
    return value;
}
const output = document.getElementById('output-id');

const spec = "js/data.vg.json";
    vegaEmbed("#my-chart-id", spec)
    // result.view provides access to the Vega View API
    .then(result => {
        console.log(result);
        var cache = [];
        output.innerHTML='<pre style="text-align: left;font-size:0.8em">'
            + JSON.stringify(result.vgSpec.data, dedup, 2)
        })                                
    .catch(console.warn);
</script>